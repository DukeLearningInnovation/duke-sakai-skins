function footerDetailsPanelEscHandler(e){27===e.keyCode&&toggleFooterDetailsPanel(e)}function toggleFooterDetailsPanel(e){e.preventDefault(),$PBJQ("#Mrphs-footer--details__panel").toggleClass("Mrphs-footer--details__panel-show"),$PBJQ("#Mrphs-footer--details__panel").hasClass("Mrphs-footer--details__panel-show")?($PBJQ(document).on("keyup",footerDetailsPanelEscHandler),$PBJQ("#Mrphs-footer--details__close").focus()):($PBJQ(document).off("keyup",footerDetailsPanelEscHandler),$PBJQ("#Mrphs-footer--details__info").focus())}var selectSiteModalLinks,selectSiteLastModalInTab;!function(e){
if(("object"==typeof qtip||"object"==typeof moment||"object"==typeof portal)&&"undefined"!=typeof moment){moment.locale(portal.locale),portal.socialBullhorn=$PBJQ("#Mrphs-social-bullhorn"),portal.academicBullhorn=$PBJQ("#Mrphs-academic-bullhorn");var t=function(e){return moment.unix(e.epochSecond).format("L LT")};portal.wrapNoAlertsString=function(e){return'<div class="portal-bullhorn-no-alerts">'+e+"</div>"},portal.clearBullhornAlert=function(e,t,o){$PBJQ.get("/direct/portal/clearBullhornAlert",{id:t}).done(function(){var n=$PBJQ("#portal-bullhorn-alert-"+t),i=1===$PBJQ(".portal-bullhorn-"+e+"-alert").length;n.remove(),
i&&$PBJQ(".portal-bullhorn-"+e+"-alerts").html(portal.wrapNoAlertsString(o));var a=$PBJQ(".portal-bullhorn-"+e+"-alert").length;portal.setCounter(e,a)})},portal.clearAllAlerts=function(e,t){$PBJQ.ajax({url:"/direct/portal/clearAll"+e+"Alerts",cache:!1}).done(function(){$PBJQ(".portal-bullhorn-"+e.toLowerCase()+"-alerts").html(portal.wrapNoAlertsString(t)),portal.setCounter(e.toLowerCase(),0)})},portal.acceptFriendRequest=function(e,t,o,n){confirmFriendRequest(t,e),this.clearBullhornAlert(portal.SOCIAL,o,n)},portal.ignoreFriendRequest=function(e,t,o,n){ignoreFriendRequest(t,e),this.clearBullhornAlert(portal.SOCIAL,o,n)},
$PBJQ(document).ready(function(){portal.socialBullhorn.qtip({suppress:!1,position:{adjust:{scroll:!1},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{event:"click",delay:0,solo:portal.academicBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(e,o){return $PBJQ.ajax({url:"/direct/portal/socialAlerts.json",cache:!1}).then(function(e){if(e.message&&"NO_ALERTS"===e.message)return portal.wrapNoAlertsString(e.i18n.noAlerts);var o='<div class="portal-bullhorn-social-alerts">';return e.alerts.forEach(function(n){
"profile.friend.request"===n.event?o+='<a href="javascript:;" class="portal-bullhorn-connectionmanager-pending">':"profile.friend.confirm"===n.event?o+='<a href="javascript:;" class="portal-bullhorn-connectionmanager-current">':o+='<a href="'+n.url+'">',o+='<div id="portal-bullhorn-alert-'+n.id+'" class="portal-bullhorn-social-alert"><div class="portal-bullhorn-photo" style="background-image:url(/direct/profile/'+n.from+'/image/thumb)"></div><div class="portal-bullhorn-content"><div class="portal-bullhorn-message"><span class="portal-bullhorn-display-name">'+n.fromDisplayName+"</span>",
"profile.wall.item.new"===n.event?o+=e.i18n.wallPost:"profile.status.update"===n.event?o+=e.i18n.statusUpdate:"profile.wall.item.comment.new"===n.event?o+=e.i18n.postComment:"profile.friend.request"===n.event?o+=e.i18n.friendRequest:"profile.friend.confirm"===n.event?o+=e.i18n.friendConfirm:"profile.message.sent"===n.event?o+=e.i18n.message:"commons.comment.created"===n.event?o+=e.i18n.commentCreated:o+=e.i18n.unrecognisedAlert;var i=t(n.eventDate);o+='</div><div class="portal-bullhorn-time">'+i+'</div><div class="portal-bullhorn-options">',
"profile.friend.request"===n.event&&(o+='<a href="javascript:;" onclick="portal.acceptFriendRequest(\''+n.from+"','"+n.to+"','"+n.id+"','"+e.i18n.noAlerts+"');\">"+e.i18n.accept+"</a>",o+='<a href="javascript:;" onclick="portal.ignoreFriendRequest(\''+n.from+"','"+n.to+"','"+n.id+"','"+e.i18n.noAlerts+"');\">"+e.i18n.ignore+"</a>"),o+="</div>",o+='</div><div class="portal-bullhorn-clear"><a href="javascript:;" onclick="portal.clearBullhornAlert(\'social\', \''+n.id+"','"+e.i18n.noAlerts+'\');" title="'+e.i18n.clear+'"><i class="fa fa-times" aria-hidden="true"></i></a></div></div></a>'}),
o+='<div id="portal-bullhorn-clear-all"><a href="javascript:;" onclick="portal.clearAllAlerts(\'Social\',\''+e.i18n.noAlerts+"');\">"+e.i18n.clearAll+"</a></div>",o+="</div>"},function(e,t,n){o.set("content.text",t+": "+n)})}},events:{visible:function(e,t){$PBJQ(".portal-bullhorn-connectionmanager-pending").click(function(e){portal.connectionManager.show({state:"pending"}),t.hide()}),$PBJQ(".portal-bullhorn-connectionmanager-current").click(function(e){portal.connectionManager.show(),t.hide()})}}}),portal.academicBullhorn.qtip({suppress:!1,position:{adjust:{scroll:!1},my:"top right",at:"bottom left",target:portal.socialBullhorn},show:{
event:"click",delay:0,solo:portal.socialBullhorn},style:{classes:"portal-bullhorns"},hide:{event:"click unfocus"},content:{text:function(e,o){return $PBJQ.ajax({url:"/direct/portal/academicAlerts.json",dataType:"json",cache:!1}).then(function(e){if(e.message&&"NO_ALERTS"===e.message)return portal.wrapNoAlertsString(e.i18n.noAlerts);var o='<div class="portal-bullhorn-academic-alerts">';return e.alerts.forEach(function(n){var i=n.title,a=n.siteTitle,r="fa-bullhorn";"asn.new.assignment"===n.event||"asn.grade.submission"===n.event?r="fa-file-text":"lessonbuilder.comment.create"===n.event&&(r="fa-leanpub"),
o+='<a href="'+n.url+'" style="text-decoration: none;"><div id="portal-bullhorn-alert-'+n.id+'" class="portal-bullhorn-academic-alert"><div class="portal-bullhorn-icon fa fa-stack"><i class="fa fa-circle fa-stack-2x"></i><i class="fa '+r+' fa-stack-1x fa-inverse"></i></div><div class="portal-bullhorn-content"><div class="portal-bullhorn-message"><span class="portal-bullhorn-display-name">'+n.fromDisplayName+"</span>";var s=""
;"annc.new"===n.event||"annc.revise.availability"===n.event?s=e.i18n.announcement.replace("{0}",i).replace("{1}",a):"asn.new.assignment"===n.event?s=e.i18n.assignmentCreated.replace("{0}",i).replace("{1}",a):"asn.grade.submission"===n.event?s=e.i18n.assignmentSubmissionGraded.replace("{0}",i).replace("{1}",a):"commons.comment.created"===n.event?o+=e.i18n.academicCommentCreated.replace("{0}",a):"lessonbuilder.comment.create"===n.event?o+=e.i18n.academicLessonBuilderCommentCreate.replace("{0}",a):o+=e.i18n.unrecognisedAlert;var l=t(n.eventDate);o+=s+'</div><div class="portal-bullhorn-time">'+l+"</div>",
o+='</div><div class="portal-bullhorn-clear"><a href="javascript:;" onclick="portal.clearBullhornAlert(\'academic\', \''+n.id+"','"+e.i18n.noAlerts+'\');" title="'+e.i18n.clear+'"><i class="fa fa-times" aria-hidden="true"></i></a></div></div></a>'}),o+='<div id="portal-bullhorn-clear-all"><a href="javascript:;" onclick="portal.clearAllAlerts(\'Academic\',\''+e.i18n.noAlerts+"');\">"+e.i18n.clearAll+"</a></div>",o+="</div>"},function(e,t,n){o.set("content.text",t+": "+n)})}}})}),portal.setCounter=function(e,t){var o=$PBJQ("#Mrphs-"+e+"-bullhorn"),n="social"===e?"blue":"red";o.find(".bullhorn-counter").remove(),
o.append('<span class="bullhorn-counter bullhorn-counter-'+n+'">'+t+"</span>")};var o=function(){$PBJQ.ajax({url:"/direct/portal/bullhornCounts.json",cache:!1,data:{auto:!0}}).done(function(e){portal.failedBullhornCounts=0,e.academic>0?portal.setCounter("academic",e.academic):portal.academicBullhorn.find(".bullhorn-counter").remove(),e.social>0?portal.setCounter("social",e.social):portal.socialBullhorn.find(".bullhorn-counter").remove()}).fail(function(e,t,o){console&&console.log("Failed to get the bullhorn counts. Status: "+t),console&&console.log("FAILED ERROR: "+o),portal.failedBullhornCounts=portal.failedBullhornCounts||0,
portal.failedBullhornCounts+=1,3==portal.failedBullhornCounts&&clearInterval(portal.bullhornCountIntervalId)})};portal.loggedIn&&portal.bullhorns&&portal.bullhorns.enabled&&(o(),portal.bullhornCountIntervalId=setInterval(o,portal.bullhorns.pollInterval))}}($PBJQ),$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")}),function(e){if(portal.loggedIn){portal.connectionManager=portal.connectionManager||{};var t=Handlebars.templates["connection-manager-connection"],o=Handlebars.templates["connection-manager-searchresult"],n={},i={},a=function(){return Object.keys(i).length},r={},s={};e(function(){
portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"connection-manager",namespace:"connection-manager",callback:function(){portal.i18n.loadProperties({resourceClass:"org.sakaiproject.portal.api.PortalService",resourceBundle:"profile-popup",namespace:"connection-manager"})}})});var l=0,c="connections",d=0,u="";portal.connectionManager.show=function(p){var f=e("#connection-manager");f.modal({width:320})
;var h=e("#connection-manager-connectionsview"),v=e("#connection-manager-searchresultsview"),g=e("#connection-manager-searchresultsview-count"),m=e("#connection-manager-navbar-current > span > a"),P=e("#connection-manager-navbar-pending > span > a"),B=function(e){if(0===e)g.html(portal.i18n.tr("connection-manager","connection_manager_no_results"));else{var t={count:e,criteria:portal.connectionManager.searchCriteria},o=e>1?portal.i18n.tr("connection-manager","connection_manager_results_count",t):portal.i18n.tr("connection-manager","connection_manager_result_count",t);g.html(o)}},$=function(){T.hide(),_.show(),h.show(),v.hide(),
m.parent().addClass("current"),P.parent().removeClass("current")},Q=function(){_.hide(),T.show(),h.show(),v.hide(),P.parent().addClass("current"),m.parent().removeClass("current")},J=function(o,n){var s=a();e("#connection-manager-connection-"+o).remove(),1===k.children().length&&b.hide();var l=r[o];l.connected=!1,l.hideConnect=!0,l.outgoing=!0,i[o]=l;var d=t(l);0===s&&(M.show().html(""),x.hide()),M.append(d),E(),("connections"===c||"searchresults"==c&&0===w.children().length)&&Q(),e("#connection-manager-cancel-button-"+o).click(H)};m.click(function(e){$()}),P.click(function(e){Q()})
;var b=e("#connection-manager-connectionsview-searchresults-wrapper"),k=e("#connection-manager-connectionsview-searchresults"),w=e("#connection-manager-searchresultsview-results");f.click(function(e){if("connection-manager-connectionsview-searchbox"!==e.target.id){var t=b[0].getBoundingClientRect();N[0].getBoundingClientRect();(e.pageX<t.left||e.pageY<t.top||e.pageX>t.left+t.width||e.pageY>t.top+t.height)&&b.hide()}})
;var y=e("#connection-manager-current-connections"),_=e("#connection-manager-current-connections-wrapper"),C=e("#connection-manager-no-current-connections-wrapper"),M=e("#connection-manager-pending-connections"),T=e("#connection-manager-pending-connections-wrapper"),x=e("#connection-manager-no-pending-connections-wrapper"),N=e("#connection-manager-connectionsview-searchbox");N.clearSearch({callback:function(){b.hide()}});var S=e("#connection-manager-searchresultsview-searchbox");0==d&&(u=P.html(),d+=1);var D=function(o){e("#connection-manager-connection-"+o).remove(),0==l&&y.html("");var a=i[o];a.outgoing=!1,a.incoming=!1,a.connected=!0
;var r=t(a);y.append(r),l+=1,e("#connection-manager-remove-button-"+o).click(R),C.hide(),delete i[o],1===k.children().length&&b.hide(),n[o]=a,E(),$()},L=function(){var t=this.dataset.userId,o=this.dataset.displayName;e.ajax("/direct/profile/"+portal.user.id+"/confirmFriendRequest?friendId="+t,{cache:!1}).done(function(e){D(t)}).fail(function(e,t,n){console.log("ERROR: failed to confirm request from '"+o+"'. errorThrown: "+n)})},A=function(t){e(".connection-manager-connection-"+t).remove(),delete i[t],1===k.children().length&&b.hide(),E()},I=function(){var t=this.dataset.userId,o=this.dataset.displayName
;e.ajax("/direct/profile/"+portal.user.id+"/ignoreFriendRequest?friendId="+t,{cache:!1}).done(function(e){A(t)}).fail(function(e,t,n){console.log("ERROR: failed to ignore request from '"+o+"'. errorThrown: "+n)})},j=function(){var t=this.dataset.userId,o=this.dataset.displayName;e.ajax("/direct/profile/"+portal.user.id+"/requestFriend?friendId="+t,{cache:!1}).done(function(e){J(t)}).fail(function(e,t,n){console.log("ERROR: failed to request connection to '"+o+"'. errorThrown: "+n)})},F=function(t){e("#connection-manager-connection-"+t).remove(),0==(l-=1)&&C.show(),delete n[t]},R=function(){var t=this.dataset.userId,o=this.dataset.displayName
;confirm(portal.i18n.tr("connection-manager","connection_manager_remove_confirm",{displayName:o}))&&e.ajax("/direct/profile/"+portal.user.id+"/removeFriend?friendId="+t,{cache:!1}).done(function(e){F(t)}).fail(function(e,t,n){console.log("ERROR: failed to remove '"+o+"'. errorThrown: "+n)})},H=function(){var t=this.dataset.userId,o=this.dataset.displayName;e.ajax("/direct/profile/"+t+"/ignoreFriendRequest?friendId="+portal.user.id,{cache:!1}).done(function(o){e(".connection-manager-connection-"+t).remove(),delete i[t],E()}).fail(function(e,t,n){console.log("ERROR: failed to ignore request from '"+o+"'. errorThrown: "+n)})},E=function(){
var e=a();0===e?(P.html(u),M.html("").hide(),x.show()):P.html(u+" ("+e+")")},q=function(a,l){e("#connection-manager-profile-popup-container .qtip").remove();var d=l?w:k;if(a.length<4)return d.html(""),void(l?B(0):b.hide());portal.connectionManager.searchCriteria=a;var u=l?t:o;e.ajax("/direct/portal/connectionsearch.json?query="+a,{cache:!1}).done(function(o){if(d.html(""),0!==o.length){l||b.show();var a="";r={},(s=o).forEach(function(e){r[e.uuid]=e}),l?s.forEach(function(e,t){a+=u(e)}):s.slice(0,5).forEach(function(e,t){a+=u(e)}),l&&B(s.length),d.html(a),d.children().length>0&&d.show(),e(function(){
l?e(".connection-manager-connect-button").click(j):profile.attachPopups(e(".profile-popup-trigger"),{hide:!0,container:"connection-manager-profile-popup-container",callbacks:{connect:J,cancel:A,accept:D,ignore:A,remove:F}}),e("#connection-manager-connectionsview-searchresults-more").click(function(o){c="searchresults",k.html(""),b.hide(),h.hide(),v.show(),S.val(portal.connectionManager.searchCriteria),N.val(""),e(function(){B(s.length);var o="";s.forEach(function(e,a){e.facebookSet=e.socialNetworkingInfo.facebookUrl,e.twitterSet=e.socialNetworkingInfo.twitterUrl,e.moreResult=!0,n.hasOwnProperty(e.uuid)&&(e.connected=!0,e.hideConnect=!0),
i.hasOwnProperty(e.uuid)&&(e.connected=!1,e.hideConnect=!0,e.outgoing=i[e.uuid].outgoing,e.incoming=i[e.uuid].incoming),o+=t(e)}),w.html(o),e(function(){e(".connection-manager-accept-button").click(L),e(".connection-manager-ignore-button").click(I),e(".connection-manager-connect-button").click(j),e(".connection-manager-remove-button").click(R),e(".connection-manager-cancel-button").click(H)})})}),e("#connection-manager-backtoconnections-link").click(function(e){c="connections",v.hide(),h.show(),b.hide(),k.html(""),N.val("")})})}else l||b.hide()})};e.ajax("/direct/profile/"+portal.user.id+"/connections.json",{cache:!1}).done(function(o){n={},
l=o.length,searchUserIdFilter=[portal.user.id],y.html(""),0==o.length?C.show():C.hide(),o.forEach(function(e){e.facebookSet=e.socialNetworkingInfo.facebookUrl,e.twitterSet=e.socialNetworkingInfo.twitterUrl,e.current=!0,e.connected=!0,e.incoming=!1,e.hideConnect=!0,n[e.uuid]=e,y.append(t(e))}),e(function(){e(".connection-manager-remove-button").click(R)})}).fail(function(e,t,o){console.log("ERROR: failed to get current connections. errorThrown: "+o)});e.ajax("/direct/profile/"+portal.user.id+"/incomingConnectionRequests.json",{cache:!1}).done(function(o){i={},o.forEach(function(e){e.incoming=!0}),
e.ajax("/direct/profile/"+portal.user.id+"/outgoingConnectionRequests.json",{cache:!1}).done(function(n){var a;n.forEach(function(e){e.outgoing=!0,o.push(e)}),0==(a=o).length?(x.show(),M.hide()):(x.hide(),M.show().html("")),a.forEach(function(e){e.hideConnect=!0,e.pending=!0,M.append(t(e)),i[e.uuid]=e}),a.length>0?P.html(u+" ("+a.length+")"):P.html(u),e(function(){e(".connection-manager-accept-button").click(L),e(".connection-manager-ignore-button").click(I),e(".connection-manager-cancel-button").click(H)})}).fail(function(e,t,o){console.log("Failed to get outgoing requests. errorThrown: "+o)})}).fail(function(e,t,o){
console.log("Failed to get incoming requests. errorThrown: "+o)}),N.keyup(function(e){q(this.value,!1)}),N.keydown(function(t){13==t.which&&this.value.length>=4&&e("#connection-manager-connectionsview-searchresults-more").click()}),S.keyup(function(e){q(this.value,!0)}),p&&"pending"===p.state&&Q()},e("#Mrphs-userNav__submenuitem--connections").click(portal.connectionManager.show)}}($PBJQ),$PBJQ(document).ready(function(){updateFooterTime=function(){
if(1==$PBJQ("#preferredTime").length)var e=$PBJQ("#preferredTime").data("preferredtzdisplay"),t=new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset"))).getTime()-(new Date).getTime();var o=$PBJQ("#serverTime").data("servertzdisplay"),n=new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset"))).getTime()-(new Date).getTime();return function(){var i=new Date((new Date).getTime()+n).toUTCString().replace(/GMT/,o).replace(/UTC/,o);if($PBJQ("#serverTime").text(i),1==$PBJQ("#preferredTime").length){i=new Date((new Date).getTime()+t).toUTCString().replace(/GMT/,e).replace(/UTC/,e)
;$PBJQ("#preferredTime").text(i)}setTimeout("updateFooterTime()",1e3)}}(),1==$PBJQ("#serverTime").length&&updateFooterTime(),$PBJQ("#Mrphs-footer--details__info").click(function(e){toggleFooterDetailsPanel(e)}),$PBJQ("#Mrphs-footer--details__close").click(function(e){toggleFooterDetailsPanel(e)})}),$PBJQ,portal.loggedIn&&(portal.i18n=portal.i18n||{},portal.i18n.translations=portal.i18n.translations||{},portal.i18n.loadProperties=function(e){if(e.namespace){var t={resourceClass:"org.sakaiproject.i18n.InternationalizedMessages",resourceBundle:"org.sakaiproject.".concat(e.namespace).concat(".bundle.Messages"),namespace:e.namespace}
;(e=Object.assign(t,e)).debug&&(console.log("resourceClass: "+e.resourceClass),console.log("resourceBundle: "+e.resourceBundle),console.log("namespace: "+e.namespace)),portal.i18n.translations[e.namespace]=portal.i18n.translations[e.namespace]||{};var o=portal.locale+e.resourceClass+e.resourceBundle;null!==sessionStorage.getItem(o)?(e.debug&&console.log("Returning "+o+" from sessions storage ..."),portal.i18n.translations[e.namespace]=JSON.parse(sessionStorage[o]),e.callback&&e.callback()):(e.debug&&console.log(o+" not in sessions storage. Pulling from webservice ..."),$PBJQ.ajax({
url:"/sakai-ws/rest/i18n/getI18nProperties"+portal.portalCDNQuery,cache:!0,contentType:"application/json",data:{locale:portal.locale,resourceclass:e.resourceClass,resourcebundle:e.resourceBundle}}).done(function(t,n,i){t.split("\n").forEach(function(t){var o=t.split("=");2==o.length&&(portal.i18n.translations[e.namespace][o[0]]=o[1]),e.debug&&(console.log("Updated translations: "),console.log(portal.i18n.translations[e.namespace]))}),sessionStorage[o]=JSON.stringify(portal.i18n.translations[e.namespace]),e.callback&&e.callback()}).fail(function(e,t,o){console.error(o)}))
}else console.log("You must supply at least a namespace. Doing nothing ...")},portal.i18n.tr=function(e,t,o){if(e&&t){var n=portal.i18n.translations[e][t];if(!n)return console.log(e+"#key "+t+" not found. Returning key ..."),t;if(null!=o)for(var i in o)n=n.replace("{"+i+"}",o[i]);return n}console.log("You must supply a namespace and a key.")},Handlebars.registerHelper("tr",function(e,t,o){return new Handlebars.SafeString(portal.i18n.tr(e,t,o.hash))})),$PBJQ(document).ready(function(){var e={dragModeStartMsg:"drag start, Use U and D keys to move the item up and down",dragModeEndMsg:"Drag end",newPositionMsg:"Moved to position %s"}
;$PBJQ.widget("sakai.keyboardSortable",$PBJQ.ui.sortable,{options:{keyboardHandle:!1},_create:function(){this._super(),this.options.keyboardHandle=this.options.keyboardHandle||this.options.items,this._dragging=!1,this.element.on("keydown",this.options.keyboardHandle,$PBJQ.proxy(this._keydown,this)),this.liveRegion=$PBJQ("<div class='ui-helper-hidden-accessible'></div>").liveregion().appendTo(document.body),this.element.find(this.options.keyboardHandle).attr({"aria-grabbed":"false","data-at-shortcutkeys":'{"u":"drag item up","d":"drag item down"}'}).blur($PBJQ.proxy(function(e){var t=$PBJQ(e.target)
;this._isDragging()&&this._toggleDragMode(t,this._closestSortableNode(t))},this)).click($PBJQ.proxy(function(e){if(e.clientX<=0||void 0===e.clientX){var t=$PBJQ(e.target);this._toggleDragMode(t,this._closestSortableNode(t))}},this))},_keydown:function(e){if(-1!==$PBJQ.inArray(e.which,[27,38,40,68,85])&&!$PBJQ(e.target).is(":input")){e.preventDefault();var t=$PBJQ(e.target),o=this._closestSortableNode(t);switch(e.which){case 27:this._isDragging()&&this._toggleDragMode(t,o);break;case 38:case 85:(e.ctrlKey||this._isDragging()||85===e.which)&&this._moveBackward(o,t);break;case 40:case 68:
(e.ctrlKey||this._isDragging()||68===e.which)&&this._moveForward(o,t)}}},_closestSortableNode:function(e){var t=e.parentsUntil(this.element).last();return t.length||(t=e),t},_isDragging:function(){return this._dragging},_toggleDragMode:function(t,o){var n=this._isDragging();o.toggleClass("sakai-dragging",!n),n?(t.attr("aria-grabbed","false"),this._dragging=!1,this._notify(e.dragModeEndMsg)):(this.element.find(this.options.keyboardHandle).attr("aria-grabbed","false"),this._dragging=!0,t.attr("aria-grabbed","true"),this._notify(e.dragModeStartMsg))},_moveBackward:function(e,t,o){$prevNode=e.prev(o),$prevNode.length&&($prevNode.insertAfter(e),
this._highlightDrag(e),this._notifyPosition(e))},_moveForward:function(e,t,o){$nextNode=e.next(o),$nextNode.length&&($nextNode.insertBefore(e),this._highlightDrag(e),this._notifyPosition(e))},_highlightDrag:function(e){this._isDragging()||(e.addClass("sakai-dragging-temp"),setTimeout(function(){e.removeClass("sakai-dragging-temp")},1e3))},_notifyPosition:function(t){var o=this.element.find(this.options.items).index(t)+1;this._notify(e.newPositionMsg.replace("%s",o))},_notify:function(e){this.liveRegion.liveregion("instance").notify(e),this._trigger("update")}}),$PBJQ.widget("sakai.liveregion",{_create:function(){this.timeout=null},
notify:function(e){setTimeout($PBJQ.proxy(function(){var t=$PBJQ("<div aria-live='polite'></div>").attr("role","status").appendTo(this.element);this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout($PBJQ.proxy(function(){t.text(e)},this),500),setTimeout($PBJQ.proxy(function(){this._clear(t)},this),1e4)},this),0)},_clear:function(e){e.remove()}})});var dhtml_view_sites=function(){$PBJQ("#selectSiteModal").addClass("dhtml_more_tabs"),$PBJQ(".more-tab").position();var e=.8*$PBJQ(window).height();dhtml_view_sites=function(){var t=$PBJQ("#selectSiteModal");if(t.show(),
void 0!==selectSiteModalLinks&&void 0!==selectSiteLastModalInTab||(selectSiteModalLinks=t.find("button, a"),selectSiteLastModalInTab=t.find(".tab-box a:last")),t.on("keydown",function(e){var t=!1;if(!(e.ctrlKey||e.metaKey||e.altKey)){switch(e.which){case 27:closeDrawer(),t=!0;break;case 9:e.shiftKey?e.target===selectSiteModalLinks[0]&&(selectSiteModalLinks[selectSiteModalLinks.length-1].focus(),t=!0):e.target!==selectSiteModalLinks[selectSiteModalLinks.length-1]&&e.target!==selectSiteLastModalInTab[selectSiteLastModalInTab.length-1]||(selectSiteModalLinks[0].focus(),t=!0)}t&&e.preventDefault()}}),t.hasClass("outscreen")){
$PBJQ("body").toggleClass("active-more-sites");var o=(a=$PBJQ(".view-all-sites-btn:visible")).height()+5;if(a.length>0){a.css("z-index",1005);var n=a.offset().top-$PBJQ(window).scrollTop()+o,i=$PBJQ("body").outerWidth()-(a.offset().left+a.outerWidth());"rtl"!==$PBJQ("html").attr("dir")?t.css("top",n).css("right",i):t.css("top",n).css("left",$PBJQ("body").outerWidth()-i)}t.toggleClass("outscreen"),e-=n,e-=parseInt(t.css("padding-bottom"),20),MorpheusViewportHelper.isNonPhone()&&$PBJQ("#txtSearch").focus(),createDHTMLMask(dhtml_view_sites),$PBJQ(".selectedTab").bind("click",function(e){return dhtml_view_sites(),!1}),
$PBJQ(".tab-pane:first").focus(),$PBJQ(document).trigger("view-sites-shown")}else{var a;$PBJQ("body").toggleClass("active-more-sites"),$PBJQ("#selectSiteModal").toggleClass("outscreen"),(a=$PBJQ(".view-all-sites-btn")).css("z-index","auto"),$PBJQ("#selectSite").attr("tabindex","-1"),removeDHTMLMask(),$PBJQ("#otherSiteTools").remove(),$PBJQ(".selectedTab").unbind("click")}},$PBJQ(window).width()<800&&(e*=.85),$PBJQ(".tab-pane").css("height",e),dhtml_view_sites()};function closeDrawer(){$PBJQ("#selectSiteModal").toggleClass("outscreen"),removeDHTMLMask(),$PBJQ("#selectSite").attr("tabindex","-1"),$PBJQ("#otherSiteTools").remove(),
$PBJQ(".selectedTab").unbind("click"),$PBJQ(".moreSitesLink").unbind("keydown"),$PBJQ(".view-all-sites-btn a:visible").length?$PBJQ(".view-all-sites-btn a").focus():$PBJQ(".js-toggle-sites-nav").focus()}function createDHTMLMask(e){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>'),$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1e3,top:0,left:0}).attr("tabindex",-1).bind("click",function(t){return e(),!1}),$PBJQ("#portalMask").bgiframe()}function removeDHTMLMask(){$PBJQ("#portalMask").remove()}function showToolMenu(e){var t=e.attr("id"),o=t.replace(/!/g,"\\!").replace(/~/g,"\\~")
;if($PBJQ(".toolMenus").removeClass("toolMenusActive").attr("aria-expanded","false"),$PBJQ("."+o).length)$PBJQ("#otherSiteTools").remove();else{var n=$PBJQ('<ul id="otherSiteTools" role="menu" />').addClass(t),i="/direct/site/"+t+"/pages.json";scroll(0,0);var a=parseInt($PBJQ("#maxToolsInt").text()),r=$PBJQ("#maxToolsText").text(),s=$PBJQ('<li class="otherSiteTool" ><span><a role="menuitem" tabindex="-1"><span class="Mrphs-toolsNav__menuitem--icon"> </span></a></span></li>'),l=s.clone();l.addClass("gotosite"),l.find("a").attr("href",portal.portalPath+"/site/"+t).attr("title",r).append(r),l.find("a span").addClass("icon-sakai--see-all-tools"),
$PBJQ.getJSON(i,function(t){$PBJQ.each(t,function(e,t){if(!t.tools[0])return!0;if(e<a){var o=s.clone();o.find("a").attr("href",t.tools[0].url).attr("title",t.title).append(t.title),o.find("a span").addClass("icon-sakai--"+t.tools[0].toolId.replace(/\./gi,"-")).addClass("otherSiteToolIcon"),t.toolpopup&&o.find("a").attr("href",t.tools[0].url+"?sakai.popup=yes").attr("onclick","window.open("+t.toolpopupurl+"); return false"),n.append(o)}}),t.length>a&&n.append(l.clone()),$PBJQ("#otherSiteTools").remove(),e.closest("li").append(n),e.closest("li").find("ul li a").first().focus(),addArrowNavAndDisableTabNav($PBJQ("ul#otherSiteTools")),
e.parent().find(".toolMenus").addClass("toolMenusActive").attr("aria-expanded","true")})}}$PBJQ(document).ready(function(){1===$PBJQ("#eid").length&&$PBJQ("#eid").focus(),$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",dhtml_view_sites),$PBJQ("#show-all-sites, .view-all-sites-btn").on("click",dhtml_view_sites);var e=portal.siteTitle;function t(){$PBJQ("#txtSearch").val(""),$PBJQ(".fav-sites-term, .fav-sites-entry").show(),$PBJQ("#noSearchResults").hide(),$PBJQ("#txtSearch").focus()}e&&(portal.shortDescription&&(e=e+" ("+portal.shortDescription+")"),$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+e+":</span> ")),
$PBJQ("#txtSearch").keyup(function(e){if(27==e.keyCode&&t(),$PBJQ("#txtSearch").val().length>0){var o=$PBJQ("#txtSearch").val().toLowerCase();$PBJQ(".fav-sites-term, .fav-sites-entry").hide();var n=$PBJQ(".fav-sites-entry").filter(function(e,t){return $PBJQ(".fav-title a span.fullTitle",t).text().toLowerCase().indexOf(o)>=0});n.show(),n.closest(".fav-sites-term").show()}0==$PBJQ("#txtSearch").val().length&&t(),$PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1&&($PBJQ(".norecords").remove(),$PBJQ("#noSearchResults").fadeIn("slow"))}),$PBJQ("#otherSiteSearchClear").on("click",function(){t()}),
$PBJQ("#presenceToggle").click(function(e){e.preventDefault(),$PBJQ("#presenceArea").toggle()}),$PBJQ(".trayPopupClose").click(function(e){e.preventDefault(),$PBJQ(this).closest(".trayPopup").hide()}),$PBJQ("a.tool-directurl").length&&$PBJQ("a.tool-directurl").cluetip({local:!0,arrows:!0,cluetipClass:"jtip",sticky:!0,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'})}),$PBJQ(document).ready(function(e){var t=!0,o=void 0,n=[],i=$PBJQ("#max-favorite-entries").text().trim(),a=!1,r=$PBJQ("#selectSite"),s=$PBJQ("#otherSitesCategorWrap"),l=$PBJQ("#organizeFavorites"),c={}
;$PBJQ(".site-favorite-btn",s).each(function(e,t){c[$PBJQ(t).attr("data-site-id")]=$PBJQ(t).parent()});var d={favorite:{markup:'<i class="site-favorite-icon site-favorite"></i>'},nonfavorite:{markup:'<i class="site-favorite-icon site-nonfavorite"></i>'},myworkspace:{markup:'<i class="site-favorite-icon site-workspace site-favorite"></i>'}},u=function(e,t){var o=d[t];$PBJQ(e).data("favorite-state",t),
"favorite"===t?$PBJQ(e).attr("title",$PBJQ("#removeFromFavoritesText").text().replace("[site]",$PBJQ(e).parent().find("span.fullTitle").text())):"nonfavorite"===t?$PBJQ(e).attr("title",$PBJQ("#addToFavoritesText").text().replace("[site]",$PBJQ(e).parent().find("span.fullTitle").text())):$PBJQ(e).attr("title",null),$PBJQ(e).empty().append($PBJQ(o.markup))},p=function(){var e=$PBJQ(".fav-sites-entry .site-favorite",s).length;$PBJQ(".favoriteCount",r).text("("+e+")"),e>i?$PBJQ(".favoriteCountAndWarning").addClass("maxFavoritesReached"):$PBJQ(".favoriteCountAndWarning").removeClass("maxFavoritesReached")},f=function(){
$PBJQ(".favorites-select-all-none",s).each(function(e,t){var o=$PBJQ(t).closest(".fav-sites-term"),n=o.find(".fav-sites-entry:not(.my-workspace)").length,i=o.find(".fav-sites-entry .site-favorite").length;0==n?$PBJQ(t).hide():(i==n?($PBJQ(t).data("favorite-state","favorite"),$PBJQ(t).html(d.favorite.markup)):($PBJQ(t).data("favorite-state","nonfavorite"),$PBJQ(t).html(d.nonfavorite.markup)),$PBJQ(t).show())})},h=function(e){$PBJQ(".site-favorite-btn",s).each(function(t,o){var n=$PBJQ(o).attr("data-site-id");$PBJQ(o).closest(".my-workspace").length>0?u(o,"myworkspace"):$PBJQ.inArray(n,e)>=0?u(o,"favorite"):u(o,"nonfavorite")}),
$PBJQ(".favorites-help-text").hide(),t?$PBJQ(".favorites-help-text.autofavorite-enabled").show():$PBJQ(".favorites-help-text.autofavorite-disabled").show(),f(),p(),a=!0},v=function(e){var i;g&&(a=!1,$PBJQ(".site-favorite-btn",s).empty(),$PBJQ(".favorites-select-all-none",s).empty()),e||(e=0),g&&e<100?setTimeout(function(){v(e+1)},50):(i=h,$PBJQ.ajax({url:"/portal/favorites/list",method:"GET",dataType:"json",success:function(e){t=e.autoFavoritesEnabled,n=e.favoriteSiteIds.filter(function(e,t){return""!=e}),null==o&&(o=n),i(n)}}))},g=!1,m=[],P=function(e){for(var t;m.length>0;)t=m.shift();t?$PBJQ.ajax({url:"/portal/favorites/update",
method:"POST",dataType:"json",data:{userFavorites:JSON.stringify(t)},error:e,complete:P}):g=!1},B=function(e){if(a){e||(e=function(){});var i=$PBJQ(".site-favorite-btn",s).has(".site-favorite").map(function(){return $PBJQ(this).attr("data-site-id")}).toArray(),r={favoriteSiteIds:i=i.sort(function(e,t){return-1===n.indexOf(e)?1:-1===n.indexOf(t)?-1:n.indexOf(e)-n.indexOf(t)}),autoFavoritesEnabled:t};m.push(r),g||(g=!0,P(e)),n=i,function(){if(function(e,t){if(e.length!=t.length)return!1;for(var o=0;o<e.length;o++)if(e[o]!=t[o])return!1;return!0
}(n,o))$PBJQ(".moresites-refresh-notification").remove();else if(!($PBJQ(".moresites-refresh-notification").length>0)){var e=$PBJQ('<div class="moresites-refresh-notification" />').html($PBJQ("#refreshNotificationText").html());$PBJQ("#loginLinks").prepend(e),e.css("top",$PBJQ(".Mrphs-siteHierarchy").offset().top+"px")}}()}},$=function(e){if(o&&o.indexOf(e)>-1){for(var t=o.indexOf(e),i=!1,a=t-1;a>=0;a--){var r=o[a],s=n.indexOf(r);if(s>=0&&s<t){n.splice(s+1,0,e),i=!0;break}}i||n.splice(t,0,e)}};$PBJQ(s).on("click",".site-favorite-btn",function(){var e,t=$PBJQ(this).attr("data-site-id"),o=$PBJQ(this).data("favorite-state")
;"myworkspace"!==o&&("favorite"==(e="favorite"===o?"nonfavorite":"favorite")&&$(t),u(this,e),f(),p(),B(function(){v()}))}),$PBJQ(s).on("click",".favorites-select-all-none",function(){var e,t=$PBJQ(this).data("favorite-state"),o=$PBJQ(this).closest(".fav-sites-term").find(".fav-sites-entry:not(.my-workspace) .site-favorite-btn");e="favorite"==t?"nonfavorite":"favorite",o.each(function(t,o){u($PBJQ(o),e)}),p(),f(),B(function(){v()})}),$PBJQ(r).on("click",".tab-btn",function(){$PBJQ(".tab-btn",r).removeClass("active").attr("aria-selected","false").attr("tabindex","-1"),
$PBJQ(this).addClass("active").attr("aria-selected","true").attr("tabindex","0");var e=$PBJQ(this).data("tab-target");$PBJQ(".tab-box").hide(),$PBJQ(r).trigger("tab-shown",e),$PBJQ("#"+e).show()}),$PBJQ(r).on("keydown",".tab-btn",function(e){32==e.keyCode&&($PBJQ(this).click(),e.preventDefault()),37==e.keyCode&&($PBJQ("[aria-selected=true]").prev().click().focus(),e.preventDefault()),38==e.keyCode&&($PBJQ("[aria-selected=true]").prev().click().focus(),e.preventDefault()),39==e.keyCode&&($PBJQ("[aria-selected=true]").next().click().focus(),e.preventDefault()),40==e.keyCode&&($PBJQ("[aria-selected=true]").next().click().focus(),
e.preventDefault())}),$PBJQ(document).on("view-sites-shown",function(){v()}),$PBJQ(r).on("tab-shown",function(e,o){if("organizeFavorites"===o){var a=$PBJQ("#organizeFavoritesList");a.empty(),$PBJQ("#noFavoritesToShow").hide(),$PBJQ("#favoritesToShow").hide(),$PBJQ("#otherSiteTools").remove(),$PBJQ("#organizeFavoritesPurgatoryList").empty(),$PBJQ.each(n,function(e,t){if(c[t]&&!$PBJQ(c[t]).hasClass("my-workspace")){var o=c[t].clone(!1);o.addClass("organize-favorite-item").data("site-id",t);var n=$PBJQ('<a href="javascript:void(0);" class="fav-drag-handle"><i class="fa fa-bars"></i></a>');$PBJQ(".toolMenus",o).remove(),o.append(n),a.append(o),
o.show()}}),0==a.find("li").length?$PBJQ("#noFavoritesToShow").show():$PBJQ("#favoritesToShow").show();var r=function(){var e=$PBJQ(".organize-favorite-item");e.removeClass("site-favorite-is-past-max"),$PBJQ(".favorites-max-marker").remove(),$PBJQ.each(e,function(e,t){e>=i&&$PBJQ(t).addClass("site-favorite-is-past-max"),e==i&&$PBJQ(t).before($PBJQ('<li class="favorites-max-marker"><i class="fa fa-warning warning-icon"></i> '+$PBJQ("#maxFavoritesLimitReachedText").text()+"</li>"))})};r(),a.keyboardSortable({items:"li:not(.favorites-max-marker)",handle:".fav-drag-handle",update:function(){r(),
n=a.find(".organize-favorite-item *[data-site-id]").map(function(){return $PBJQ(this).attr("data-site-id")}).toArray(),B()}}),a.disableSelection(),$PBJQ("#autoFavoritesEnabled").attr("aria-checked",t),$PBJQ("#organizeFavorites .onoffswitch").show()}}),$PBJQ(s).on("click",".toolMenus",function(e){return e.preventDefault(),showToolMenu($PBJQ(this)),!1}),$PBJQ(l).on("click",".site-favorite-btn",function(){if(!($PBJQ(this).closest(".my-workspace").length>0)){var e,t=$PBJQ(this).parent();if(0==$PBJQ(this).closest("#organizeFavoritesList").length){var o=$PBJQ(this).attr("data-site-id");$(o);var i=n.indexOf(o)
;0==i?$PBJQ("#organizeFavoritesList").prepend(t):i>0?$PBJQ("#organizeFavoritesList li:nth-child("+i+")").after(t):$PBJQ("#organizeFavoritesList").append(t),e="favorite"}else $PBJQ("#organizeFavoritesPurgatoryList").append(t),e="nonfavorite";u(this,e),u(c[$PBJQ(this).attr("data-site-id")].find(".site-favorite-btn"),e),f(),p(),B(function(){v()})}}),$PBJQ("#autoFavoritesEnabled").click(function(){$PBJQ(this).attr("aria-checked",function(e,t){return String(!("true"===t))}),$PBJQ(this).trigger("change")}),$PBJQ("#autoFavoritesEnabled").on("change",function(){return t="true"===$PBJQ(this).attr("aria-checked"),$PBJQ(".favorites-help-text").hide(),
t?$PBJQ(".favorites-help-text.autofavorite-enabled").show():$PBJQ(".favorites-help-text.autofavorite-disabled").show(),B(),!0}),$PBJQ(".otherSitesMenuClose").on("click",function(){dhtml_view_sites()})});var profile=profile||{};function publishSite(e){var t="/direct/site/"+e+"/edit";$PBJQ.ajax({type:"POST",data:"published=true",url:t,success:function(){location.reload()}}).responseText}function quickLinksNavEscHandler(e){27===e.keyCode&&toggleQuickLinksNav(e)}function toggleQuickLinksNav(e){if(e.preventDefault(),$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")||toggleUserNav(e),
$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden"),$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden"))$PBJQ(".quicklinks-dropdown-overlay").remove(),$PBJQ("body").css("overflow-y","visible"),$PBJQ(document).off("keyup",quickLinksNavEscHandler);else{var t=$PBJQ('<div class="quicklinks-dropdown-overlay" />');t.on("click",function(e){toggleQuickLinksNav(e)}),$PBJQ("body").prepend(t),$PBJQ("body").css("overflow-y","hidden"),$PBJQ(document).on("keyup",quickLinksNavEscHandler),$PBJQ(".tab-box").css("max-height",window.innerHeight-$PBJQ("#selectQuickLink").offset().top-14)}}!function(e){profile.requestFriend=function(t,o,n){
return new Promise((i,a)=>{e.ajax({url:"/direct/profile/"+t+"/requestFriend?friendId="+o,dataType:"text",cache:!1}).done(function(t,a,r){e("#profile-popup-request-button-"+o).hide(),e("#profile-popup-cancel-button-"+o).show(),n&&n(o),i(!0)}).fail((e,t,o)=>a())})},profile.confirmFriendRequest=function(t,o,n){return new Promise((i,a)=>{e.ajax({url:"/direct/profile/"+t+"/confirmFriendRequest?friendId="+o,dataType:"text",cache:!1}).done(function(t,a,r){e("#profile-popup-incoming-block-"+o).hide(),e("#profile-popup-remove-button-"+o).show(),n&&n(o),i(!0)}).fail((e,t,o)=>a())})},profile.removeFriend=function(t,o,n,i){return new Promise((i,a)=>{
e.ajax({url:"/direct/profile/"+t+"/removeFriend?friendId="+o,dataType:"text",cache:!1}).done(function(t,a,r){e("#profile-popup-remove-button-"+o).hide(),e("#profile-popup-request-button-"+o).show(),n&&n(o),i(!0)}).fail((e,t,o)=>a())})},profile.ignoreFriendRequest=function(t,o,n,i){return new Promise((a,r)=>{e.ajax({url:"/direct/profile/"+t+"/ignoreFriendRequest?friendId="+o,cache:!1}).done(function(r,s,l){void 0!==n&&1==n?(e("#profile-popup-cancel-button-"+t).hide(),e("#profile-popup-request-button-"+t).show(),i&&i(t)):(e("#profile-popup-incoming-block-"+o).hide(),e("#profile-popup-request-button-"+o).show(),i&&i(o)),a(!0)
}).fail((e,t,o)=>r())})},profile.attachPopups=function(t,o){if(t instanceof e){o||(o={});var n=o.hide,i=o.callbacks;i||(i={}),t.each(function(){var t=this.dataset.userId,a=(this.dataset.displayName,e(this).find(".profile-popup-target")),r={target:a.length>0?a.eq(0):e(this),my:"top left",at:"bottom center",viewport:e(window),adjust:{method:"flipinvert none"}};o&&o.container&&(r.container=e(`#${o.container}`)),e(this).qtip({position:r,show:{event:"click",delay:0},style:{classes:"profile-popup-qtip qtip-shadow"},hide:{event:"click unfocus"},content:{text:function(o,n){return e.ajax({url:"/direct/portal/"+t+"/formatted",cache:!1
}).then(function(e){return e},function(e,t,o){n.set("content.text",t+": "+o)})}},events:{visible:function(o,a){e("#profile-popup-request-button-"+t).off("click").on("click",e=>{profile.requestFriend(portal.user.id,t,i.connect).then(()=>{n&&a.hide()})}),e("#profile-popup-cancel-button-"+t).off("click").on("click",e=>{profile.ignoreFriendRequest(t,portal.user.id,!0,i.cancel).then(()=>{n&&a.hide()})}),e("#profile-popup-accept-button-"+t).off("click").on("click",e=>{profile.confirmFriendRequest(portal.user.id,t,i.accept).then(()=>{n&&a.hide()})}),e("#profile-popup-ignore-button-"+t).off("click").on("click",e=>{
profile.ignoreFriendRequest(portal.user.id,t,!1,i.ignore).then(()=>{n&&a.hide()})}),e("#profile-popup-remove-button-"+t).off("click").on("click",e=>{profile.removeFriend(portal.user.id,t,i.remove).then(()=>{n&&a.hide()})})}}})})}else console.log("profile.attachPopups takes a jQuery object array, from a selector")}}($PBJQ),$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav),$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav),$PBJQ(document).ready(function(){return $PBJQ("#reorder-list li").size()-1>15&&($PBJQ(".grabHandle").show(),$PBJQ("#inputFieldMessage").show(),$PBJQ("#inputKbdMessage").remove()),
$PBJQ("#reorder-list li").each(function(e){$PBJQ("#lastMoveArrayInit").append($PBJQ(this).attr("id")+" "),$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")}),$PBJQ('input[id^="index"]').click(function(e){e.stopPropagation()}),$PBJQ('input[id^="index"]').bind("keypress",function(e){return 13!=(e.charCode||e.keyCode)}),$PBJQ("#undo-all").click(function(e){var t;for(z in t=$PBJQ.trim($PBJQ("#lastMoveArrayInit").text()).split(" "))thisRow=document.getElementById(t[z]),$PBJQ(thisRow).appendTo("#reorder-list");e.preventDefault(),registerChange(),$PBJQ("#undo-all").hide(),$PBJQ("#undo-all-inact").show(),$PBJQ("#undo-last-inact").show(),
$PBJQ("#undo-last").hide()}),$PBJQ("#undo-last").click(function(e){var t,o,n;for(z in t=$PBJQ.trim($PBJQ("#lastMoveArray").text()).split(" "))thisRow=document.getElementById(t[z]),$PBJQ(thisRow).appendTo("#reorder-list");o=$PBJQ.trim($PBJQ("#lastItemMoved").text()),n=$PBJQ("li:eq("+o.substr(20)+")"),$PBJQ(n).addClass("recentMove"),e.preventDefault(),registerChange("notfluid",n),$PBJQ("#undo-last-inact").fadeIn("slow"),$PBJQ("#undo-last").hide()}),$PBJQ('input[id^="index"]').change(function(){var e=this;preserveStatus();var t=parseInt($PBJQ(this).siblings('input[id^="holder"]').attr("value")),o=parseInt(this.value)
;if(isNaN(o)||o>$PBJQ('input[id^="index"]').size()){var n=$PBJQ("#failedValidMessage").text();$PBJQ("#messageHolder").text(n.replace("#",$PBJQ('input[id^="index"]').size())),$PBJQ(".orderable-selected").removeClass("orderable-selected"),$PBJQ("#messageHolder").removeClass("messageSuccess"),$PBJQ("#messageHolder").addClass("messageValidation");var i=$PBJQ(e).position();return $PBJQ("#messageHolder").css({position:"absolute",height:"1.3em",top:i.top,left:55}),$PBJQ("#messageHolder").fadeIn("slow"),$PBJQ("#messageHolder").animate({opacity:1},2e3,function(){$PBJQ(e).val(t),e.focus(),e.select()}),$PBJQ("#messageHolder").fadeOut("slow"),
$PBJQ(this).parents("li").addClass("orderable-selected"),null}var a=$PBJQ('input[id^="index"]');$PBJQ("#undo-last").fadeIn("slow"),$PBJQ("#undo-last-inact").hide(),$PBJQ("#undo-all").fadeIn("slow"),$PBJQ("#undo-all-inact").hide(),
"1"===o?$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")):o==a.length?$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")):o>t?$PBJQ($PBJQ(this).parents("li")).insertAfter($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")):$PBJQ($PBJQ(this).parents("li")).insertBefore($PBJQ(this).parents("li").siblings("li").children("span").children("input[value="+o+"]").parents("li")),
registerChange("notfluid",$PBJQ(this).parents("li"))}),$PBJQ("#reorder-list").keyboardSortable({items:"li:not(.notsortable)",start:function(e,t){preserveStatus(t)},update:function(e,t){registerChange(e,t)}})});var registerChange=function(e,t){$PBJQ("#reorder-list li").size();"notfluid"!==e&&(t=$PBJQ("li[aria-selected='true']")),$PBJQ("#lastItemMoved").text($PBJQ(t).attr("id")),$PBJQ(t).addClass("recentMove");$PBJQ(t.prevAll("li").length+1);for(var o=$PBJQ('input[id^="index"]'),n=$PBJQ('input[id^="holder"]'),i=$PBJQ("select.selectSet"),a=0;a<o.length;a+=1)$PBJQ(o[a]).attr("value",a+1).val(a+1)
;for(var r=0;r<n.length;r+=1)$PBJQ(n[r]).attr("value",r+1).val(r+1);for(var s=0;s<i.length;s+=1)$PBJQ(i[s]).val(s+1),$PBJQ(i[s]).find("option").removeAttr("selected"),$PBJQ(i[s]).find("option[value="+(s+1)+"]").attr("selected","selected");$PBJQ("#undo-last").fadeIn("slow"),$PBJQ("#undo-last-inact").hide(),$PBJQ("#undo-all").fadeIn("slow"),$PBJQ("#undo-all-inact").hide(),$PBJQ(t).animate({opacity:1},2e3,function(){$PBJQ(t).removeClass("recentMove")})},preserveStatus=function(e){$PBJQ("#lastMoveArray").text(""),$PBJQ("#reorder-list li").each(function(e){
void 0!==$PBJQ(this).attr("id")&&"undefined_avatar"!==$PBJQ(this).attr("id")&&$PBJQ("#lastMoveArray").append($PBJQ(this).attr("id")+" ")})};function toggleToolsNav(e){e&&e.preventDefault(),$PBJQ("body").toggleClass("toolsNav--displayed"),$PBJQ("body").hasClass("toolsNav--displayed")?createDHTMLMask(toggleToolsNav):removeDHTMLMask()}$PBJQ(document).ready(function(){$PBJQ("#roleSwitchSelect").on("change",function(){""!==$PBJQ("option:selected",this).text()?document.location=$PBJQ("option:selected",this).val()+"#roleSwitch":$PBJQ(this)[0].selectedIndex=0}),MorpheusViewportHelper.isPhone()?function(){function e(){
$PBJQ("#roleSwitchDropDown").is(".open")&&$PBJQ("#roleSwitchDropDownToggle").trigger("click")}function t(t){return 27!=t.keyCode||(e(),!1)}$PBJQ("#roleSwitchDropDownToggle").attr("aria-hidden","false").attr("aria-haspopup","true"),$PBJQ("#roleSwitchDropDown").attr("aria-hidden","true"),$PBJQ("#roleSwitchDropDownToggle").click(function(){$PBJQ("#roleSwitchDropDown").css("right",$PBJQ(window).width()-20-($PBJQ("#roleSwitchDropDownToggle").offset().left+$PBJQ("#roleSwitchDropDownToggle").width())),$PBJQ("#roleSwitchDropDown").toggleClass("open"),$PBJQ("#roleSwitchDropDown").is(".open")?($PBJQ("#roleSwitchDropDown").attr("aria-hidden","false"),
$PBJQ(document.body).prepend('<div class="user-dropdown-overlay"></div>'),$PBJQ(".user-dropdown-overlay").on("click",function(){e()}),$PBJQ(document.body).on("keyup",t),setTimeout(function(){$PBJQ("#roleSwitchDropDown").find("a, :input").focus()})):($PBJQ("#roleSwitchDropDown").attr("aria-hidden","true"),$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document.body).off("keyup",t),$PBJQ("#roleSwitchDropDownToggle").focus())})}():$PBJQ("#roleSwitch").addClass("menu-not-setup")}),$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav)
;var sessionTimeOut,timeoutDialogWarningTime,timeoutLoggedoutUrl,timeoutPortalPath,sessionId="current",timeoutDialogEnabled=!1;$PBJQ(document).ready(function(){portal.loggedIn&&portal.timeoutDialog&&setTimeout("setup_timeout_config();",6e4)});var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled,timeoutDialogWarningTime=portal.timeoutDialog.seconds,timeoutLoggedoutUrl=portal.loggedOutUrl,timeoutPortalPath=portal.portalPath,1==timeoutDialogEnabled&&(poll_session_data(),fetch_timeout_dialog())},poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date).getTime(),
dataType:"json",success:function(e){if(e.maxInactiveInterval=1e3*e.maxInactiveInterval,e.active&&null!=e.userId&&e.lastAccessedTime+e.maxInactiveInterval>e.currentTime){var t=e.lastAccessedTime+e.maxInactiveInterval-e.currentTime;t<1e3*timeoutDialogWarningTime?(min=Math.round(t/6e4),show_timeout_alert(min),clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",6e4)):(clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",t-1e3*timeoutDialogWarningTime))}else null==e.userId?location.href=timeoutLoggedoutUrl:sessionTimeOut=setTimeout("poll_session_data()",1e4)},error:function(e,t,o){}})}
;function keep_session_alive(){dismiss_session_alert(),$PBJQ.get(timeoutPortalPath)}var timeoutDialogFragment,dismiss_session_alert=function(){removeDHTMLMask(),$PBJQ("#timeout_alert_body").remove()};function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:!0,dataType:"text",success:function(e){timeoutDialogFragment=e},error:function(e,t,o){timeoutDialogEnabled=!1}})}function show_timeout_alert(e){if(timeoutDialogEnabled)if($PBJQ("#portalMask").get(0)||(createDHTMLMask(dismiss_session_alert),$PBJQ("#portalMask").css("z-index",1e3)),$PBJQ("#timeout_alert_body").get(0))$PBJQ("#timeout_alert_body span").html(e);else{
var t=timeoutDialogFragment.replace("{0}",e);$PBJQ("body").append(t)}}function toggleShortUrlOutput(e,t,o){$PBJQ(t).is(":checked")?$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(e),dataType:"text",success:function(e){$PBJQ("."+o).val(e)}}):$PBJQ("."+o).val(e)}$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(e){var t=$PBJQ(this).position(),o=$PBJQ(this).siblings(".Mrphs-directUrl");o.toggleClass("active").css({left:t.left+"px"}),o.attr("aria-expanded","true"),o.find("[tabindex]").first().focus(),e.preventDefault()}),$modal_container=$PBJQ(".Mrphs-directUrl"),$modal_container.each(function(e){
var t=$PBJQ(this).find("[tabindex]");t.first().on("keydown",function(e){if(9===e.keyCode&&e.shiftKey)return t.last().focus(),e.preventDefault(),!1}),t.last().on("keydown",function(e){if(9===e.keyCode&&!e.shiftKey)return t.first().focus(),e.preventDefault(),!1})}),$modal_container.last().on("keypress",function(e){if(9===e.keyCode())return console.log("keypress:: primero"),$modal_container.fist().focus(),e.preventDefault(),!1}),$PBJQ(".Mrphs-directUrl .dropDown_close").on("click keypress",function(e){var t=$PBJQ(this).parent();t.toggleClass("active"),t.removeAttr("aria-expanded"),
$PBJQ('.Mrphs-toolTitleNav__link--directurl[rel="#'+t.attr("id")+'"]').focus(),e.preventDefault()})});var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var e=$PBJQ(this).attr("href");$PBJQ(e).attr("tabindex","-1").focus()})};$PBJQ(document).ready(function(){var e=0;$PBJQ(document).scroll(function(t){var o=$PBJQ(this).scrollTop();o>e&&o>90?($PBJQ(".Mrphs-topHeader").addClass("moving"),$PBJQ(".Mrphs-siteHierarchy").addClass("moving"),$PBJQ(".Mrphs-toolsNav__title--current-site").addClass("moving"),$PBJQ(".Mrphs-skipNav__menu").addClass("moving"),
$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").addClass("moving")):(o>90||0==o)&&($PBJQ(".Mrphs-topHeader").removeClass("moving"),$PBJQ(".Mrphs-siteHierarchy").removeClass("moving"),$PBJQ(".Mrphs-toolsNav__title--current-site").removeClass("moving"),$PBJQ(".Mrphs-skipNav__menu").removeClass("moving"),$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").removeClass("moving")),e=o})});var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible"),$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible"),
$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked"),$PBJQ(".sitenav-dropdown-overlay").remove()},buildDropdownMenu=function(e,t,o){var n='<ul class="Mrphs-sitesNav__submenu" role="menu">',i=parseInt($PBJQ("#linkNav").attr("data-max-tools-int")),a=$PBJQ("#linkNav").attr("data-max-tools-anchor"),r='<li class="Mrphs-sitesNav__submenuitem Mrphs-sitesNav__submenuitem__gotosite"><a tabindex="-1" role="menuitem" href="'+portal.portalPath+"/site/"+t+'" title="'+a+'"><span class="toolMenuIcon icon-sakai--see-all-tools"></span>'+a+"</a></li>",s="/direct/site/"+t+"/pages.json",l=window.location.pathname.split("/").pop()
;$PBJQ.ajax({url:s,dataType:"json",success:function(t){$PBJQ.each(t,function(e,t){if(t.tools&&!(t.tools.length<=0)){var o="";if(l==t.tools[0].id&&(o=" is-current"),e<=i){var a
;if(t.toolpopup)a='<li class="Mrphs-sitesNav__submenuitem" ><a tabindex="-1" class="Mrphs-sitesNav__submenuitem-link"'+' role="menuitem" href="{{tool_url}}?sakai.popup=yes" title="{{item_title}}" onclick="window.open(\'{{item_toolpopupurl}}\');"'+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>';else a='<li class="Mrphs-sitesNav__submenuitem{{is_current}}"><a tabindex="-1" class="Mrphs-sitesNav__submenuitem-link"'+' role="menuitem" href="{{tool_url}}" title="{{item_title}}"'+'>  <span class="Mrphs-sitesNav__submenuitem-icon"><span class="toolMenuIcon icon-sakai--{{icon}}"></span></span>  <span class="Mrphs-sitesNav__submenuitem-title">{{item_title}}</span></a></li>'
;n+=a.replace(/{{tool_url}}/g,t.tools[0].url).replace(/{{item_title}}/g,t.title).replace(/{{item_toolpopupurl}}/g,t.toolpopupurl).replace(/{{icon}}/g,t.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,o)}}}),t.length-1>i&&(n+=r),n+="</ul>",n=$PBJQ(n),e.append(n),addArrowNavAndDisableTabNav(n),o(n)},error:function(e,t,o){}})},setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(e){27==e.keyCode&&closeAllDropdownMenus()})}),$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",function(e){if(40==e.keyCode){e.preventDefault()
;var t=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown");t.data("clicked")||(t.data("clicked",!0),t.trigger("click"))}else 27==e.keyCode&&(e.preventDefault(),closeAllDropdownMenus())}),$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(e){e.preventDefault();var t=$PBJQ(e.target),o=t.parent(".Mrphs-sitesNav__menuitem"),n=o.hasClass("dropdown-is-visible");if(closeAllDropdownMenus(),!n){var i=$PBJQ(this),a=function(e){i.addClass("is-clicked"),o.addClass("dropdown-is-visible"),e.addClass("is-visible"),o.find("li a").first().focus();var t=$PBJQ('<div class="sitenav-dropdown-overlay" />');t.on("click",function(e){
closeAllDropdownMenus()}),$PBJQ("body").prepend(t),i.removeData("clicked")};o.find("ul").length?a(o.find("ul")):buildDropdownMenu(o,t.attr("data-site-id"),a)}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")})};function addArrowNavAndDisableTabNav(e){e.find("li a").attr("tabindex","-1").keydown(function(t){var o=$PBJQ(t.target);if(40==t.keyCode){t.preventDefault();var n=o.closest("li").next();0!==n.length&&0!=n.find("a").length||(n=e.find("li").first()),e.find("li a").attr("tabindex","-1"),n.find("a").focus().attr("tabindex","0")}else if(38==t.keyCode){t.preventDefault();var i=o.closest("li").prev()
;0===i.length&&(i=e.find("a").closest("ul")),e.find("li a").attr("tabindex","-1"),i.find("a").focus().attr("tabindex","0")}else 9==t.keyCode&&closeAllDropdownMenus()})}function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:!1,success:function(e){var t=$PBJQ("#presenceIframe");t.html(e);var o=$PBJQ("#presenceCount");if(t.is(":empty"))return o.html(" "),o.removeClass("present").addClass("empty"),void location.reload();var n=t.find(".listUser").length;n>1?(o.html(n+""),o.removeClass("empty").addClass("present")):1==n?($PBJQ("#presenceCount").html(n+""),o.removeClass("present").addClass("empty")):($PBJQ("#presenceCount").html(" "),
o.removeClass("present").addClass("empty"));var i=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");$PBJQ("#presenceIframe .presenceList div.inChat span").wrap('<a href="'+i+'"></a>'),sakaiLastPresenceTimeOut=setTimeout("updatePresence()",3e4)},error:function(e,t){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",6e4)}})}function userNavEscHandler(e){27===e.keyCode&&toggleUserNav(e)}function toggleUserNav(e){if(e.preventDefault(),$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden"),$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden"))$PBJQ(".user-dropdown-overlay").remove(),$PBJQ(document).off("keyup",userNavEscHandler);else{
var t=$PBJQ('<div class="user-dropdown-overlay" />');t.on("click",function(e){toggleUserNav(e)}),$PBJQ("body").prepend(t),$PBJQ(document).on("keyup",userNavEscHandler)}}portal=portal||{},void 0===portal.toolsCollapsed&&(portal.toolsCollapsed=!1),portal.updateToolsCollapsedPref=function(e){if(portal.user.id){var t="/direct/userPrefs/updateKey/"+portal.user.id+"/sakai:portal:sitenav?toolsCollapsed="+e;$PBJQ.ajax(t,{method:"PUT",cache:!1})}},portal.toggleMinimizeNav=function(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed"),$PBJQ("#subSites.floating").css({display:"none"});var e=$PBJQ(this)
;e.toggleClass("min max").parent().toggleClass("min max"),portal.toolsCollapsed?(portal.updateToolsCollapsedPref(!1),portal.toolsCollapsed=!1,e.attr("aria-pressed",!1)):(portal.updateToolsCollapsedPref(!0),portal.toolsCollapsed=!0,e.attr("aria-pressed",!0))},$PBJQ("#toolsNav-toggle-li button").on("click",portal.toggleMinimizeNav),$PBJQ(document).ready(function(){$PBJQ("#toggleSubsitesLink").click(function(e){var t=$PBJQ(this);if("block"==$PBJQ("#subSites").css("display"))$PBJQ("#subSites").hide(),$PBJQ("#subSites").removeClass("floating");else{var o=t.position(),n=-1*($PBJQ("#toolMenu").height()-o.top),i=MorpheusViewportHelper.isPhone()?{
display:"block",top:0,overflow:"hidden"}:{display:"block",left:$PBJQ("#toolMenu").width()+7+"px",top:n+"px"};$PBJQ("#subSites").css(i),$PBJQ("#subSites").addClass("floating"),$PBJQ("#subSites").find("li a").first().focus(),$PBJQ("#toggleSubsitesLink").position().top<240&&$PBJQ("#subSites.floating").addClass("ontop")}})}),$PBJQ("#loginLink1").click(function(e){""===$PBJQ(this).attr("data-warning")||confirm($PBJQ(this).attr("data-warning"))||e.preventDefault()}),$PBJQ(".js-toggle-user-nav a#loginUser > .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav),
$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav),$PBJQ(".Mrphs-userNav__pic-changer").on("click",function(e){var t=$PBJQ(this);if(!window.FileReader)return $PBJQ(t.data("profileLink")).trigger("click"),!0;if(!$PBJQ.fn.modal)return $PBJQ(t.data("profileLink")).trigger("click"),!0;function o(e){var t;l.show(),l.find("> img").cropper("clear"),l.find("> img").cropper("replace",e),r.removeProp("disabled"),t=$PBJQ("#cropToolbar").show(),portal.pictureToolbarSetup||($PBJQ(".profile-image-zoom-in",t).on("click",function(){l.find("> img").cropper("zoom",.1)}),
$PBJQ(".profile-image-zoom-out",t).on("click",function(){l.find("> img").cropper("zoom",-.1)}),$PBJQ(".profile-image-pan-up",t).on("click",function(){l.find("> img").cropper("move",0,-10)}),$PBJQ(".profile-image-pan-down",t).on("click",function(){l.find("> img").cropper("move",0,10)}),$PBJQ(".profile-image-pan-left",t).on("click",function(){l.find("> img").cropper("move",10,0)}),$PBJQ(".profile-image-pan-right",t).on("click",function(){l.find("> img").cropper("move",-10,0)}),$PBJQ(".profile-image-rotate",t).on("click",function(){l.find("> img").cropper("clear"),l.find("> img").cropper("rotate",90),l.find("> img").cropper("crop")}),
portal.pictureToolbarSetup=!0)}function n(){$PBJQ.getJSON("/direct/profile-image/details?_="+(new Date).getTime(),function(e){"SUCCESS"==e.status&&(e.isDefault||(o(e.url+"?_="+(new Date).getTime()),$PBJQ(".remove-profile-image").on("click",function(){a.find(".modal-body .alert").hide(),$PBJQ.ajax("/direct/profile-image/remove",{data:{sakai_csrf_token:sakai_csrf_token},type:"POST",dataType:"json",success:function(e,t,o){"SUCCESS"==e.status?(i(),$PBJQ("#cropToolbar").hide()):$PBJQ("#remove-error").show()}})}))),sakai_csrf_token=e.csrf_token})}function i(){var e=$PBJQ("#loginUser > .Mrphs-userNav__submenuitem--profilepicture"),t=e.parent()
;e.detach();var o=new Date,n="background-image: url(/direct/profile/"+portal.user.id+"/image/thumb?"+o.getTime()+")";e.attr("style",n),t.prepend(e),t=(e=$PBJQ(".Mrphs-userNav__submenuitem--profilelink > .Mrphs-userNav__submenuitem--profilepicture")).parent(),e.detach(),e.attr("style",n),t.prepend(e),$PBJQ("#profileImageUpload").modal("hide")}e.preventDefault(),e.stopImmediatePropagation();var a=$PBJQ("#profileImageUpload");a.on("shown.bs.modal",function(){n()}),a.modal({width:320}),$PBJQ("#remove-error").hide(),$PBJQ("#upload-error").hide();var r=a.find("#save"),s=$PBJQ("#file"),l=$PBJQ("#cropme").hide();return l.find("> img").cropper({
aspectRatio:1,checkCrossOrigin:!1,guides:!0,minContainerWidth:300,minContainerHeight:300,autoCropArea:1,viewMode:1,dragMode:"move"}),s.on("change",function(){$PBJQ(this);if(!this.files||!this.files[0])throw"Browser does not support FileReader";var e=new FileReader;e.onload=function(e){o(e.target.result)},e.readAsDataURL(this.files[0])}),r.on("click",function(e){new Promise(function(e){e(l.find("> img").cropper("getCroppedCanvas",{width:200,height:200}).toDataURL())}).then(function(e){var t;t=e.replace(/^data:image\/(png|jpg);base64,/,""),a.find(".modal-body .alert").hide(),$PBJQ.ajax("/direct/profile-image/upload",{data:{
sakai_csrf_token:sakai_csrf_token,base64:t},type:"POST",dataType:"json",success:function(e,t,o){"SUCCESS"==e.status?i():$PBJQ("#upload-error").show()}})})}),!1});var header=$PBJQ(".Mrphs-topHeader"),currentHeaderWidth=-1;function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(e,t,o){var n=e||0;return t&&(!n||n>t)&&(n=t),o&&(!n||n>o)?o:n}$PBJQ(document).ready(function(){$PBJQ(header).data("sticked",!1),
$PBJQ(".Mrphs-hierarchy--parent-sites").length>0&&$PBJQ(window).width()<=800&&$PBJQ("#content").css("margin-top",parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(!0)+"px"),$PBJQ(window).resize(function(){currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width()}),$PBJQ(window).scroll(function(){var e=$PBJQ(document).height()-$PBJQ(window).height()>$PBJQ(header).height()==!0;$PBJQ(window).scrollTop()>0?!1===$PBJQ(header).data("sticked")&&!0===e&&($PBJQ(header).data("sticked",!0),$PBJQ(".Mrphs-mainHeader").addClass("is-fixed")):($PBJQ(".Mrphs-mainHeader").removeClass("is-fixed"),
$PBJQ(header).data("sticked",!1))}),currentHeaderWidth=$PBJQ(".Mrphs-mainHeader").width(),$PBJQ(".Mrphs-headerLogo").on("click",function(){document.body.scrollTop=0,document.body.scrollLeft=0,$PBJQ(window).trigger("scroll")})}),$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){$PBJQ(this).prop("disabled")&&$PBJQ(this).parent("label").addClass("disabled")}),$PBJQ(document).keyup(function(e){27==e.keyCode&&($PBJQ("#selectSiteModal").hasClass("outscreen")||$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click"),$PBJQ(".Mrphs-directUrl__dropDown").each(function(){
$PBJQ(this).hasClass("active")&&$PBJQ(this).find(".dropDown_close").trigger("click")}),$PBJQ(".fip-icon-up-dir").trigger("click"),$PBJQ(".navigatePanelControls .close").trigger("click"))})});var MorpheusViewportHelper={isPhone:function(){return $PBJQ("#Mrphs-viewport-helpers .phone").is(":visible")},isTablet:function(){return $PBJQ("#Mrphs-viewport-helpers .tablet").is(":visible")},isDesktop:function(){return $PBJQ("#Mrphs-viewport-helpers .desktop").is(":visible")},isNonPhone:function(){return(this.isDesktop()||this.isTablet())&&!this.isPhone()}};$PBJQ(document).ready(function(){
1==$PBJQ("#loginLink2").length&&$PBJQ("#loginLink2").click(function(e){$PBJQ("body").append('<div id="Mrphs-xlogin-container" />'),$PBJQ("#Mrphs-xlogin-container").load("/portal/xlogin #Mrphs-xlogin",function(){$PBJQ("#Mrphs-xlogin-container").addClass("loaded"),$PBJQ("#Mrphs-xlogin").addClass("loadedByAjax"),$PBJQ("#eid").focus()}),$PBJQ(".Mrphs-portalWrapper").addClass("blurry"),$PBJQ("body").append('<div id="loginPortalMask" />'),$PBJQ("#loginPortalMask").bgiframe(),$PBJQ("#loginPortalMask").click(function(){$PBJQ("#loginPortalMask").remove(),$PBJQ("#Mrphs-xlogin-container").remove(),$PBJQ(".Mrphs-portalWrapper").removeClass("blurry")}),
e.preventDefault()})}),function(e){console.log("duke-default/_customization.js loaded"),e(".Mrphs-toolTitleNav__link--directurl").on("click",function(t){var o=e(this).siblings(".Mrphs-toolTitleNav__link--help-popup")[0].search,n={hitType:"event",eventCategory:"toolTitleNav",eventAction:"showDirectLink",eventLabel:document.title+" : "+o.substring(6,o.length)};ga("send",n)}),e(".Mrphs-toolTitleNav__link--help-popup").on("click",function(t){var o=e(this)[0].search,n={hitType:"event",eventCategory:"toolTitleNav",eventAction:"goToHelp",eventLabel:document.title+" : "+o.substring(6,o.length)};ga("send",n)}),e("#print-view").on("click",function(t){
var o=e(this)[0].search,n={hitType:"event",eventCategory:"toolTitleNav",eventAction:"lessionsPrintView",eventLabel:document.title+" : "+o.substring(6,o.length)};ga("send",n)}),e("#print-all").on("click",function(t){var o=e(this)[0].search,n={hitType:"event",eventCategory:"toolTitleNav",eventAction:"lessionsPrintAll",eventLabel:document.title+" : "+o.substring(6,o.length)};ga("send",n)}),e("#show-pages").on("click",function(t){var o=e(this)[0].search,n={hitType:"event",eventCategory:"toolTitleNav",eventAction:"lessionsIndexOfPages",eventLabel:document.title+" : "+o.substring(6,o.length)};ga("send",n)}),
e(".Mrphs-sitesNav__dropdown").on("click",function(t){var o=e(this).siblings("a.link-container")[0].title,n={hitType:"event",eventCategory:"sitesNav",eventAction:"openToolDropdown",eventLabel:document.title+" : "+o};ga("send",n)}),e(".Mrphs-hierarchy--toolName").on("click",function(e){var t={hitType:"event",eventCategory:"hierarchy",eventAction:"refreshTool",eventLabel:document.title};ga("send",t)}),e(".view-all-sites-btn").on("click",function(e){var t={hitType:"event",eventCategory:"topHeader",eventAction:"openAllSitesDropdown",eventLabel:document.title};ga("send",t)}),e("#toolsNav-toggle-li").on("click",function(t){var o="undefined"
;e(this).hasClass("min")?o="collapseTools":e(this).hasClass("max")&&(o="maximizeTools");var n={hitType:"event",eventCategory:"toolMenu",eventAction:o,eventLabel:document.title};ga("send",n)}),e("#print-view").on("click",function(e){var t={hitType:"event",eventCategory:"toolTitleNav",eventAction:"showLessonsPrintView",eventLabel:document.title};ga("send",t)}),e("#show-pages").on("click",function(e){var t={hitType:"event",eventCategory:"toolTitleNav",eventAction:"showLessonsPages",eventLabel:document.title};ga("send",t)}),e("#loginLink1").find(".Mrphs-login-Message").text().startsWith("Return")&&e("body").addClass("become-user")
;var t=new URL(window.location.href).hostname.replace(/\./g,"-");e("body").addClass(t),e("body").addClass(portal.user.siteRole.toLowerCase());var o,n=0,i=function(){var t=document.getElementsByClassName("pasystem-banner-alerts")[0],o=document.getElementsByClassName("pasystem-banner-alert-toggle")[0],i={childList:!0,attributes:!0,subtree:!0,attributeOldValue:!0},a=function(o,i){for(var a of o)"childList"==a.type&&(n=t.clientHeight,e("#toolsNav-toggle-li").css({top:n})),"attributes"==a.type&&a.target.className.includes("pasystem-banner-alert")&&(n=t.clientHeight,e("#toolsNav-toggle-li").css({top:n}))
},r=new MutationObserver(a),s=new MutationObserver(a);r.observe(t,i),s.observe(o,i)};if(o=document.getElementsByClassName("Mrphs-portalBody")[0],new MutationObserver(function(t,o){for(var a of t)"childList"==a.type&&"pasystem-banner-alerts"==a.target.childNodes[0].className&&(n=document.getElementsByClassName("pasystem-banner-alerts")[0].clientHeight,e("#toolsNav-toggle-li").css({top:n}),i(),o.disconnect())}).observe(o,{childList:!0}),e(window).scroll(function(){e(window).scrollTop()>0?e("#toolsNav-toggle-li").css({top:0}):e("#toolsNav-toggle-li").css({top:n})}),"Sakai : Home : Overview"===document.title){window.setTimeout(function(){
let e=document.getElementsByClassName("Mrphs-toolBody--sakai-motd")[0].getElementsByTagName("iframe")[0].contentWindow.document.getElementsByClassName("textPanel"),t=[].slice.call(e),o=Math.max.apply(Math,t.map(function(e){return e.clientHeight}));for(let n=0;n<t.length;n++)e[n].style.height=`${o}px`,e[n].getElementsByTagName("a")[0].style.cssText="bottom: 16px"},1e3)}if((document.querySelector('#msgForum .itemNav .button[title=" < Previous Topic"]')||document.querySelector('#msgForum .itemNav .button[title=" Next Topic >"]'))&&document.getElementsByClassName("topicBloc topicBlocLone specialLink")&&window.innerWidth>1030){
let e=49+document.getElementsByClassName("topicBloc topicBlocLone specialLink")[0].clientHeight;document.querySelector("#msgForum .itemNav").style.cssText=`top:${e}px`}}($PBJQ),$PBJQ,console.log("duke-nursing/_customization.js loaded");
/* Compiled on 2019-09-13_15-24-58 */
